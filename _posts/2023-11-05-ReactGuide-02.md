---
layout: post
title: ReactGuide-02
date: 2023-11-05 16:45:30.000000000 +09:00
categories: [Web, React, 入门]
tags: [Web, React]
---


# React 中的事件处理
* 通过 `onXxx` 属性指定事件处理函数（注意大小写）
  * React 使用的是自定义（合成）事件，而不是使用的原生 `DOM` 事件
  * React 中的事件是通过事件委托方式处理的（委托给了组件最外层的元素），为了高效
    * 例如：`div` 包着 `input`，在 `input` 上加事件，其实是委托给 `div`
* 通过 `event.target` 得到发生事件的 `DOM` 元素对象
  * 不要过渡使用 `Ref`，如果发生事件的 `Ref` 正好是你要操作的 `Ref`，这时这个 `Ref` 可以省略，可通过 `event.target` 获取
  * 例如下边的 `showData2`
  
  
```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>hello react</title>
  </head>
  <body>
    <!-- 准备好一个容器 -->
    <div id="test"></div>

    <!-- 引入 react 核心库 -->
    <script type="text/javascript" src="../js/react.development.js"></script>

    <!-- 引入 react-dom 库，用于支持 react 操作 DOM -->
    <script
      type="text/javascript"
      src="../js/react-dom.development.js"
    ></script>

    <!-- 引入 babel，用于将 jsx 转为 js -->
    <script type="text/javascript" src="../js/babel.min.js"></script>

    <!-- 引入 prop-types，用于对组件标签属性进行限制 -->
    <script type="text/javascript" src="../js/prop-types.js"></script>

    <script type="text/babel">
      class Demo extends React.Component {
        /*
          React.createRef 调用后可以返回一个容器，该容器可存储被 ref 所标识的节点
          该容器是“专人专用”的
        */
        myRef = React.createRef();

        myRef2 = React.createRef();

        render() {
          return (
            <div>
              <input
                ref={this.myRef}
                type="text"
                placeholder="点击按钮提示数据"
              />
              <button onClick={this.showData}>点击按钮提示数据</button>
              <input
                onBlur={this.showData2}
                type="text"
                placeholder="失去焦点提示数据"
              />
            </div>
          );
        }
        // 展示左侧输入框的数据
        showData = () => {
          console.log(this.myRef);
          alert(this.myRef.current.value);
        };

        showData2 = (event) => {
          //   alert(this.myRef2.current.value);
          alert(event.target.value);
        };
      }
      ReactDOM.render(<Demo />, document.getElementById("test"));
    </script>
  </body>
</html>
```

# 非受控组件
* 非受控组件：即页面中所有输入类的 DOM 组件，`选用选取的`

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>hello react</title>
  </head>
  <body>
    <!-- 准备好一个容器 -->
    <div id="test"></div>

    <!-- 引入 react 核心库 -->
    <script type="text/javascript" src="../js/react.development.js"></script>

    <!-- 引入 react-dom 库，用于支持 react 操作 DOM -->
    <script
      type="text/javascript"
      src="../js/react-dom.development.js"
    ></script>

    <!-- 引入 babel，用于将 jsx 转为 js -->
    <script type="text/javascript" src="../js/babel.min.js"></script>

    <!-- 引入 prop-types，用于对组件标签属性进行限制 -->
    <script type="text/javascript" src="../js/prop-types.js"></script>

    <script type="text/babel">
      class Login extends React.Component {
        handleSubmit = (event) => {
          event.preventDefault(); // 阻止表单提交
          const { username, password } = this;
          alert(`输入的用户名是：${username.value}，密码是：${password.value}`);
        };

        render() {
          return (
            /*
                action 的 url 是提交页面，默认为 Get 请求
                input 中的 name="username"，会作为 Get 请求的 query
             */
            <form action="http://www.xxx.com" onSubmit={this.handleSubmit}>
              用户名：
              <input
                ref={(c) => (this.username = c)}
                type="text"
                name="username"
              />
              密码：
              <input
                ref={(c) => (this.password = c)}
                type="password"
                name="password"
              />
              <button>登录</button>
            </form>
          );
        }
      }
      ReactDOM.render(<Login />, document.getElementById("test"));
    </script>
  </body>
</html>
```

# 受控组件
* 受控组件：页面中所有输入类 DOM，随着你的输入把数据维护到 `state` 中，等需要用的时候直接从 `state` 中取


```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>hello react</title>
  </head>
  <body>
    <!-- 准备好一个容器 -->
    <div id="test"></div>

    <!-- 引入 react 核心库 -->
    <script type="text/javascript" src="../js/react.development.js"></script>

    <!-- 引入 react-dom 库，用于支持 react 操作 DOM -->
    <script
      type="text/javascript"
      src="../js/react-dom.development.js"
    ></script>

    <!-- 引入 babel，用于将 jsx 转为 js -->
    <script type="text/javascript" src="../js/babel.min.js"></script>

    <!-- 引入 prop-types，用于对组件标签属性进行限制 -->
    <script type="text/javascript" src="../js/prop-types.js"></script>

    <script type="text/babel">
      class Login extends React.Component {
        state = {
          username: "",
          password: "",
        };

        // 表单回调
        handleSubmit = (event) => {
          event.preventDefault(); // 阻止表单提交
          const { username, password } = this.state;
          alert(`输入的用户名是：${username}，密码是：${password}`);
        };

        // 保存用户名到状态中
        saveUsername = (event) => {
          console.log(event.target.value);
          this.setState({ username: event.target.value });
        };

        // 保存密码到状态中
        savePassword = (event) => {
          this.setState({ password: event.target.value });
        };

        render() {
          return (
            /*
                action 的 url 是提交页面，默认为 Get 请求
                input 中的 name="username"，会作为 Get 请求的 query
             */
            <form action="http://www.xxx.com" onSubmit={this.handleSubmit}>
              用户名：
              <input onChange={this.saveUsername} type="text" name="username" />
              密码：
              <input
                onChange={this.savePassword}
                type="password"
                name="password"
              />
              <button>登录</button>
            </form>
          );
        }
      }
      ReactDOM.render(<Login />, document.getElementById("test"));
    </script>
  </body>
</html>
```

> 建议多使用受控组件，因为这会防止 `Ref` 的过度使用
{: .prompt-info }


# 通过高阶函数柯里化实现合并上例用户名和密码

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>hello react</title>
  </head>
  <body>
    <!-- 准备好一个容器 -->
    <div id="test"></div>

    <!-- 引入 react 核心库 -->
    <script type="text/javascript" src="../js/react.development.js"></script>

    <!-- 引入 react-dom 库，用于支持 react 操作 DOM -->
    <script
      type="text/javascript"
      src="../js/react-dom.development.js"
    ></script>

    <!-- 引入 babel，用于将 jsx 转为 js -->
    <script type="text/javascript" src="../js/babel.min.js"></script>

    <!-- 引入 prop-types，用于对组件标签属性进行限制 -->
    <script type="text/javascript" src="../js/prop-types.js"></script>

    <script type="text/babel">
      //#region
      /*
        高阶函数：如果一个函数符合下面2个规范中的任何一个，那该函数就是高阶函数
        1. 若 A 函数，接收的参数是一个函数，那么 A 就可以称为高阶函数
        2. 若 A 函数，调用的返回值依然是一个函数，那么 A 就可以称为高阶函数
        常见的高阶函数：Promise、setTimeout、arr.map() 等等
      */
      //#endregion

      class Login extends React.Component {
        state = {
          username: "",
          password: "",
        };

        // 表单回调
        handleSubmit = (event) => {
          event.preventDefault(); // 阻止表单提交
          const { username, password } = this.state;
          alert(`输入的用户名是：${username}，密码是：${password}`);
        };

        // 合并 saveUsername 和 savePassword 为 saveFormData

        saveFormData = (dataType) => {
          console.log("$", dataType);
          // 这个函数才是真正 onChange 的回调
          return (event) => {
            /*
                let a = "name";
                let obj = {};
                obj.name = "tom";
                obj[a] = "tom";   取 name 属性
                console.log(obj);
                这里  用 [] 取 dataType 属性
            */
            this.setState({ [dataType]: event.target.value });
            console.log("@", dataType, event.target.value);
          };
        };
        render() {
          return (
            <form onSubmit={this.handleSubmit}>
              用户名：
              <input
                // 将 saveFormData 返回的函数赋值给 onChange
                onChange={this.saveFormData("username")}
                type="text"
                name="username"
              />
              密码：
              <input
                onChange={this.saveFormData("password")}
                type="password"
                name="password"
              />
              <button>登录</button>
            </form>
          );
        }
      }
      ReactDOM.render(<Login />, document.getElementById("test"));
    </script>
  </body>
</html>
```

# 不使用函数柯里化实现合并上例用户名和密码

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>hello react</title>
  </head>
  <body>
    <!-- 准备好一个容器 -->
    <div id="test"></div>

    <!-- 引入 react 核心库 -->
    <script type="text/javascript" src="../js/react.development.js"></script>

    <!-- 引入 react-dom 库，用于支持 react 操作 DOM -->
    <script
      type="text/javascript"
      src="../js/react-dom.development.js"
    ></script>

    <!-- 引入 babel，用于将 jsx 转为 js -->
    <script type="text/javascript" src="../js/babel.min.js"></script>

    <!-- 引入 prop-types，用于对组件标签属性进行限制 -->
    <script type="text/javascript" src="../js/prop-types.js"></script>

    <script type="text/babel">
      class Login extends React.Component {
        state = {
          username: "",
          password: "",
        };

        // 表单回调
        handleSubmit = (event) => {
          event.preventDefault(); // 阻止表单提交
          const { username, password } = this.state;
          alert(`输入的用户名是：${username}，密码是：${password}`);
        };

        // 合并 saveUsername 和 savePassword 为 saveFormData

        saveFormData = (dataType, event) => {
          console.log("$", dataType);
          this.setState({ [dataType]: event.target.value });
        };
        render() {
          return (
            <form onSubmit={this.handleSubmit}>
              用户名：
              <input
                // 使用 (event) => { ... } 赋值给 onChange
                onChange={(event) => {
                  this.saveFormData("username", event);
                }}
                type="text"
                name="username"
              />
              密码：
              <input
                onChange={(event) => {
                  this.saveFormData("password", event);
                }}
                type="password"
                name="password"
              />
              <button>登录</button>
            </form>
          );
        }
      }
      ReactDOM.render(<Login />, document.getElementById("test"));
    </script>
  </body>
</html>
```
