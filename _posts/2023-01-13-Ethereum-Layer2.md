---
layout: post
title: 以太坊和 Layer2
date: 2023-01-13 16:45:30.000000000 +09:00
categories: [区块链, Ethereum]
tags: [区块链, Ethereum]
---

# 前言
以太坊扩容通过分片等技术，提高 TPS，降低交易费用。很多的 Layer2 解决方案是把之前一些链上处理的操作放到链下处理，通过 L2 协议把大部分交易放到链下处理，然后再把交易的处理结果汇总返回到链上大大降低链上的工作量。

那么那些方案属于 Layer2 ？业界的观点是 Layer2 要继承 Layer1 的安全性。
所以侧链不属于 Layer2，因为侧链独立运行，并且有自己的共识协议和验证者。侧链与主链是脱节的。

# Rollup（卷起）
Rollup 扩容的方式，可理解为就是把上千个交易捆绑在一起处理再把压缩后的数据上传到以太坊主网，大幅提高交易的处理效率

![image](/assets/images/eth/layer2-1.png)

## Rollup 工作原理
![image](/assets/images/eth/layer2-2.png)

首先在以太坊部署一个智能合约来记录状态（账户的状态和交易的状态），这个通过 Merkle 树根的哈希值表示（即上图的 state root），
Merkle 树中的叶子节点是 Rollup 中的账户状态信息，Rollup 把多个交易卷起来打包依批次向以太坊发送一个交易，这个交易的计算是在链下完成的，
执行交易会改变账户的状态信息也会改变 state root 的哈希值，但这个更新不需要实时的发布到链上。可以将交易批量打包进行压缩然后让这一个批次所包含的
压缩后的数据以及状态更新统一提交给主链上的智能合约。完成一次 Rollup 类的状态转移确认。这样做的好处是可以一次性的验证很多个交易，大大提高效率同时继承了
以太坊的安全性。即在不牺牲安全性的情况下，把 TPS 提高成百上千甚至更高。`即交易不需要在 Layer1 上执行，在 Layer2 执行交易后把压缩后的数据上传回主链`。
这些交易数据时放在 `CoreData` 里的，Solidity 中以 `CoreData` 形式传递的参数是不会被解析的也不会被执行，
Solidity 就把它当成是一组字节存储在区块链的历史日志里，不同的 Layer2 方案在数据可用性上也存在差别，比如有的把数据放在链上，有的会把数据放在链下，
数据放在链下可以进一步的提高 TPS 但是付出的代价是安全性。另一个问题是不在链上存数据，将来要用找不到怎么办？

08:07






[hardhat-starter-kit](https://github.com/smartcontractkit/hardhat-starter-kit)

