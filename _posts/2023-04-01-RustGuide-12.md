---
layout: post
title: RustGuide-12
date: 2023-04-01 16:45:30.000000000 +09:00
categories: [Rust]
tags: [Rust]
---

# 15 智能指针
* Rust 中最常见的指针就是 `引用`
* 引用
1. 使用 & 符号
2. 会借用它指向的值
3. 没有其余的开销
4. 最常见的指针类型

## 智能指针
* 智能指针是这样的一些数据结构
1. 行为与指针相似
2. 有额外的元数据和功能

## 引用计数（reference counting）智能指针类型
* 通过记录所有者的数量，使一份数据被多个所有者同时持有
* 并且在没有任何所有者时自动清理数据
* 像 OC 的 ARC

* 引用和智能指针的区别
1. 引用：只借用数据
2. 智能指针：很多时候都拥有它所指向的数据

### 智能指针的例子
* String 和 `Vec<T>`
1. 都拥有一片内存区域，并且允许用户对其操作
2. 还拥有元数据（例如容量等）
3. 还提供额外的功能和保障（String 保障其数据是合法的 UTF-8 编码）

### 智能指针的实现
* 通常使用 struct 实现，并且实现了 `Deref` 和 `Drop` 这两个 trait
* `Deref` trait：允许智能指针 struct 的实例像引用一样使用，这样就能同时用于引用和智能指针
* `Drop` trait：允许你自定义当智能指针实例走出作用域时的代码


### 标准库中常见的智能指针
* `Box<T>` 在 heap 内存上分配值
* `Rc<T>` 启用多重所有权的引用计数类型
* `Ref<T>` 和 `RefMut<T>`，通过 RefCell<T> 访问的：在运行时而不是编译时强制借用规则的类型
* 内部可变模式（interior mutability pattern）：这个模式不可变类型可暴露出可修改其内部值的 API（像 swift 的 mutating）



>
{: .prompt-info }







