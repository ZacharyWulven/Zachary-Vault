---
layout: post
title: Python-爬虫入门-02
date: 2023-07-22 16:45:30.000000000 +09:00
categories: [Python, 爬虫]
tags: [Python, 爬虫]
---

## 17 xpath

### 安装步骤

1. 安装 xpath
* chrome 安装 xpath helper 插件
* xpath 快捷键 `Ctrl + Shift + X`
2. 安装 lxml

```bash
$ pip3 install lxml
```

3. 导入 etree

```python
from lxml import etree
```

###  xpath 解析
1. 解析本地文件：使用 `etree.parse`
2. 解析服务器响应文件：`etree.HTML(response.read().decode('utf-8'))`   

### 解析本地文件

* html 

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <!-- 这里必须结束有个 /，否则 etree.parse 会失败-->
    <meta charset="UTF-8" />
    <title>Title</title>
</head>
<body>
    <ul>
        <li id="l1" class="c1">北京</li>
        <li id="l2">上海</li>
        <li id="c3" class="l3">深圳</li>
        <li id="c4">武汉</li>
    </ul>
</body>
</html>
```

* xpath 基本语法

```python
from lxml import etree

# xpath 解析本地文件
tree = etree.parse('17_解析_xpath_基本使用.html')
print(tree)

# tree.xpath('xpath 路径')

# xpath 基本语法
# 1. 路径查询
# // 查找所有子孙节点，不考虑层级关系
# / 查找直接子节点

# 查找 ul 下的 li
li_list = tree.xpath('//ul/li')
print(li_list)

# 2. 谓词查询
# //div[@id]
# //div[@id="maincontent"]

# 查找所有有 id 属性的 li 标签
#li_list = tree.xpath('//ul/li[@id]')

# 查找 id 为 l1 的 li 标签，要注意引号的问题
li_list = tree.xpath('//ul/li[@id="l1"]')


# 3. 属性查询
# //@class

# 查找 id=l1 的标签的 class 的属性值
cls = tree.xpath('//ul/li[@id="l1"]/@class')
print(cls)

# 4. 内容查询
# text() 获取标签中的内容
li_list = tree.xpath('//ul/li[@id]/text()')
print('contents = %s' % li_list)

# 5. 模糊查询（用的少）
# //div[contains(@id, "he")]
# //div[starts-with(@id, "he")]

# case1：包含用 contains，查询 id 包含 l 的标签
li_list = tree.xpath('//ul/li[contains(@id, "l")]/text()')
print('id.contains l list = %s' % li_list)

# case2：以什么开头用 starts-with
li_list = tree.xpath('//ul/li[starts-with(@id, "c")]/text()')
print('starts-with l list = %s' % li_list)


# 6. 逻辑运算（用的少）
# [@id="l1" and @class="c1"]，id 为 l1 并且 class 为 c1 的标签
# 查询 id=l1 或 class=l3 的 li 标签
li_list = tree.xpath('//ul/li[@id="l1" or @class="l3"]/text()')
print('logic l list = %s' % li_list)

# 或者这么写
li_list = tree.xpath('//ul/li[@id="l1"]/text() | //ul/li[@class="l3"]/text()')
print('logic l list 2 = %s' % li_list)
```


> 如果环境有问题可以点 Pycharm 右下角的 Python Interpreter 进行配置
{: .prompt-info }

