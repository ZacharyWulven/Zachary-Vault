---
layout: post
title: RustGuide-02
date: 2023-03-11 16:45:30.000000000 +09:00
categories: [Rust]
tags: [Rust]
---

# 所有权（Rust Core）
* 所有权时 Rust 最独特的特性，它让 Rust 无需 GC 就可以保证内存安全

## 什么是所有权
* 所有程序在运行时都必须管理它们使用计算机内存的方式
1. 有些语言有垃圾回收机制，在程序运行时它们会不断寻找不用的内存
2. 有些语言程序员需要显示的分配和释放内存

* 而 Rust 使用第三种方式
1. 内存是通过所有权系统管理的，其中包含一组编译器在编译时检查的规则
2. 在程序运行时所有权特性不会减慢程序的运行速度

## Stack（栈内存）VS Heap（堆内存）
* 一个值在 stack 上还是 heap 上对语言的行为和你要做某些决定是有很大影响的

## Stack 栈内存
* 按值的接收顺序存储，按相反的顺序将它们移除（后进先出，LIFO）
1. 添加数据叫压入栈
2. 移除数据叫弹出栈

* 所有存储在 stack 上的数据必须拥有已知的固定的大小

## Heap 堆内存
* 编译时大小未知的数据或运行时大小可能发生变化的数据必须存放在 heap 上
* heap 的内存组织性差一些，当你把数据放入 heap 时，你会请求一定数量的空间
* 操作系统在 heap 中找到一块足够大的空间，把它标记为已用，然后返回一个指针，即这个空间的地址，
这个过程就叫在 heap 上进行分配



## Stack VS Heap

* 因为指针是已知的固定的，所以可以把指针放在 stack 上
1. 但如果想要实际数据，就必须使用指针来定位它

* 把数据压到 stack 上要比 heap 上分配速度快的多
1. 因为系统不需要寻找用来存储新数据的空间，这个位置永远在栈顶

* 在 heap 上分配空间需要更多的操作
1. 首先系统需要找到一个足够大的空间来存储数据，然后做好记录方便下次分配

* 访问 heap 的数据要比访问 stack 上的数据慢的多，因为需要指针才能找到 heap 中的数据
1. 属于间接访问，多了指针跳转操作
2. 现代操作系统的处理器，由于缓存的缘故，如果指令在内存中跳转次数越少，则速度越快

* 如果数据存放的距离比较近，那么处理器处理的速度就会快一些（比如 stack）
* 如果数据存放的距离比较远，那么处理器处理的速度就会慢一些（比如 heap）
1. 在 heap 上分配大量空间也是需要时间的

## 函数调用

> 
{: .prompt-info }


