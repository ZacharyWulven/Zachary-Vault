---
layout: post
title: RustGuide-04
date: 2023-03-15 16:45:30.000000000 +09:00
categories: [Rust]
tags: [Rust]
---

# 7 Package（包）、Crate（单元包）、Module（模块）

## Rust 代码组织
* 哪些细节可以暴露，哪些细节是私有的
* 作用域内哪些是有效的等


## 模块系统
* Package（包）：cargo 特性，让你构建、测试、共享 crate
* Crate（单元包）：一个树型模块结构，它可以产生一个 library 或一个可执行文件
* Module（模块）、use：让你控制代码的组织、作用域、私有路径
* Path（路径）：为 struct、function、module 等项命名的方式

## Package 和 Crate
* binary，二进制的
* library，库

### Crate Root
* 它是源代码文件
* Rust 编译器会从这里开始，是一个入口文件，可以组成你 Crate 的根 Module
* Crate 上边是 Package

### Package
* 包含一个 Cargo.toml， 它描述了如何构建这个 Crate
* 只能包含 0-1 个 library crate
* 可以有任意数量的 binary crate
* 必须至少包含一个 crate （binary 或 library）

### 新建一个 Package
```
$ cargo new package
```

### Cargo 惯例
* src/main.rs（binary crate，是入口文件）
1. 这个文件是 binary crate 的 crate root。Cargo 默认将这个文件作为这个 crate 的根
2. crate 与 package 的名相同

* src/lib.rs（library crate，是入口文件）
1. package 包含一个 library crate
2. 这个文件是这个 library crate 的 crate root
3. 这个 library crate 的名与 package 的名相同


> Cargo 会把 crate root 交给 Rust 编译器来构建 library 或 binary
{: .prompt-info }

* 一个 Package 可以同时拥有 src/main.rs 和 src/lib.rs
1. 这表明 Package 包含一个 library crate 和一个 binary crate
2. 名称与包名相同

* 一个 Package 可以有多个 binary crate
1. 文件放在 src/bin/ 下
2. 在 src/bin/ 下每个单独的文件都是一个 binary crate


## Crate 的作用
* 可以将相关功能组合到一个作用域内，便于在项目间进行共享
1. 防止冲突

## Module
* 定义 Module 来控制作用域和私有性
* Module 在一个 Crate 里，它能够将代码进行分组
* 增加可读性，易于复用
* 控制 item 的私有性，是 public 或 private

### 创建 Module
* 使用 mod 关键字
* Module 可以嵌套
* Module 可以包含其他项（struct、enum、常量、trait、函数等）的定义

```rust
// file: src/lib.rs

mod front_of_house {

    mod hosting { // 这是一个子 module
        fn add_to_waitlist() {}
        fn seat_at_table() {}
    }

    mod serving {
        fn take_order() {}
        fn serve_order() {}
        fn take_payment() {}
    }

}
```
## Path（路径）
* 为了在 Rust 中找到某个条目，需要使用 Path，类似命名空间
* Path 的两种形式
1. 绝对路径：从 crate root 开始，使用 crate 名或字面值 crate
2. 相对路径：从当前模块开始，使用 self（本身），super（上一级） 或当前模块的标识符
* Path 至少有一个标识符组成，如果有多个标识符使用两个冒号分隔，::

### 私有边界（private boundary）
* Module 不仅可以组织代码，还可以定义私有边界
* Rust 中所有条目（函数、struct、enum、方法、模块、常量）默认都是私有的
* 使用 pub 关键字声明公开，即 public

> 父级模块无法访问子模块中的私有条目，子模块中可以使用所有祖先模块中的条目。
{: .prompt-info }


```rust
mod front_of_house {

    pub mod hosting { // 这是一个子 module
        pub fn add_to_waitlist() {}
    }

}

pub fn eat_at_restaurant() {

    // 使用绝对路径调用
    // lib.rs 隐式组成了名为 crate 的模块
    // 因为 eat_at_restaurant 与 front_of_house 都在 crate 根级，所以不需要声明 pub 就可相互调用
    crate::front_of_house::hosting::add_to_waitlist();

    // 使用相对路径调用
    front_of_house::hosting::add_to_waitlist();

}
```

### super 关键字
